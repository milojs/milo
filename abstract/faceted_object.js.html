<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" charset="utf-8">
    <title>milo</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/cayman.min.css">
    <link rel="stylesheet" href="../css/prism.min.css">
    <link rel="stylesheet" href="../css/index.min.css">
    <link rel="stylesheet" href="../css/docs.min.css">
    <link rel="stylesheet" href="../css/bootstrap-responsive.min.css">
  </head>
  <body data-spy="scroll" data-target=".scrollspy">
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container"><a class="brand">Mr. Doc</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right sponsored"></ul>
          </div>
        </div>
      </div>
    </div>
    <header id="overview" class="jumbotron subhead">
      <div class="container">
        <h1>milo</h1>
        <p class="lead"></p>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="span3 bs-docs-sidebar">
          <ul class="nav nav-list bs-docs-sidenav affix-top">
            <li><a href="../index.html">Main</a></li>
            <li><a href="../abstract/facet.js.html">abstract/facet.js</a></li>
            <li class="active"><a href="../abstract/faceted_object.js.html">abstract/faceted_object.js</a></li>
            <li><a href="../abstract/registry.js.html">abstract/registry.js</a></li>
            <li><a href="../attributes/a_bind.js.html">attributes/a_bind.js</a></li>
            <li><a href="../attributes/a_class.js.html">attributes/a_class.js</a></li>
            <li><a href="../attributes/a_load.js.html">attributes/a_load.js</a></li>
            <li><a href="../attributes/index.js.html">attributes/index.js</a></li>
            <li><a href="../binder.js.html">binder.js</a></li>
            <li><a href="../classes.js.html">classes.js</a></li>
            <li><a href="../command/actions_history.js.html">command/actions_history.js</a></li>
            <li><a href="../command/cmd_registry.js.html">command/cmd_registry.js</a></li>
            <li><a href="../command/index.js.html">command/index.js</a></li>
            <li><a href="../command/transaction.js.html">command/transaction.js</a></li>
            <li><a href="../command/transaction_history.js.html">command/transaction_history.js</a></li>
            <li><a href="../components/ComponentTemplate.js.html">components/ComponentTemplate.js</a></li>
            <li><a href="../components/c_class.js.html">components/c_class.js</a></li>
            <li><a href="../components/c_facet.js.html">components/c_facet.js</a></li>
            <li><a href="../components/c_facets/Container.js.html">components/c_facets/Container.js</a></li>
            <li><a href="../components/c_facets/Css.js.html">components/c_facets/Css.js</a></li>
            <li><a href="../components/c_facets/Data.js.html">components/c_facets/Data.js</a></li>
            <li><a href="../components/c_facets/Dom.js.html">components/c_facets/Dom.js</a></li>
            <li><a href="../components/c_facets/Drag.js.html">components/c_facets/Drag.js</a></li>
            <li><a href="../components/c_facets/Drop.js.html">components/c_facets/Drop.js</a></li>
            <li><a href="../components/c_facets/Events.js.html">components/c_facets/Events.js</a></li>
            <li><a href="../components/c_facets/Frame.js.html">components/c_facets/Frame.js</a></li>
            <li><a href="../components/c_facets/Item.js.html">components/c_facets/Item.js</a></li>
            <li><a href="../components/c_facets/List.js.html">components/c_facets/List.js</a></li>
            <li><a href="../components/c_facets/ModelFacet.js.html">components/c_facets/ModelFacet.js</a></li>
            <li><a href="../components/c_facets/Options.js.html">components/c_facets/Options.js</a></li>
            <li><a href="../components/c_facets/Template.js.html">components/c_facets/Template.js</a></li>
            <li><a href="../components/c_facets/Transfer.js.html">components/c_facets/Transfer.js</a></li>
            <li><a href="../components/c_facets/cf_registry.js.html">components/c_facets/cf_registry.js</a></li>
            <li><a href="../components/c_info.js.html">components/c_info.js</a></li>
            <li><a href="../components/c_registry.js.html">components/c_registry.js</a></li>
            <li><a href="../components/c_utils.js.html">components/c_utils.js</a></li>
            <li><a href="../components/classes/View.js.html">components/classes/View.js</a></li>
            <li><a href="../components/msg_api/data.js.html">components/msg_api/data.js</a></li>
            <li><a href="../components/msg_api/de_data.js.html">components/msg_api/de_data.js</a></li>
            <li><a href="../components/msg_api/drop.js.html">components/msg_api/drop.js</a></li>
            <li><a href="../components/msg_src/dom_events.js.html">components/msg_src/dom_events.js</a></li>
            <li><a href="../components/msg_src/frame.js.html">components/msg_src/frame.js</a></li>
            <li><a href="../components/scope.js.html">components/scope.js</a></li>
            <li><a href="../config.js.html">config.js</a></li>
            <li><a href="../loader.js.html">loader.js</a></li>
            <li><a href="../milo.js.html">milo.js</a></li>
            <li><a href="../registry.js.html">registry.js</a></li>
            <li><a href="../services/de_constrs.js.html">services/de_constrs.js</a></li>
            <li><a href="../services/dom_source.js.html">services/dom_source.js</a></li>
            <li><a href="../services/mail/index.js.html">services/mail/index.js</a></li>
            <li><a href="../services/mail/mail_api.js.html">services/mail/mail_api.js</a></li>
            <li><a href="../services/mail/mail_source.js.html">services/mail/mail_source.js</a></li>
            <li><a href="../services/window.js.html">services/window.js</a></li>
            <li><a href="../use_components.js.html">use_components.js</a></li>
            <li><a href="../use_facets.js.html">use_facets.js</a></li>
            <li><a href="../util/component_name.js.html">util/component_name.js</a></li>
            <li><a href="../util/create_component_class.js.html">util/create_component_class.js</a></li>
            <li><a href="../util/create_facet_class.js.html">util/create_facet_class.js</a></li>
            <li><a href="../util/deprecate.js.html">util/deprecate.js</a></li>
            <li><a href="../util/dom.js.html">util/dom.js</a></li>
            <li><a href="../util/dom_listeners.js.html">util/dom_listeners.js</a></li>
            <li><a href="../util/domready.js.html">util/domready.js</a></li>
            <li><a href="../util/dragdrop.js.html">util/dragdrop.js</a></li>
            <li><a href="../util/error.js.html">util/error.js</a></li>
            <li><a href="../util/fragment.js.html">util/fragment.js</a></li>
            <li><a href="../util/index.js.html">util/index.js</a></li>
            <li><a href="../util/json_parse.js.html">util/json_parse.js</a></li>
            <li><a href="../util/request.js.html">util/request.js</a></li>
            <li><a href="../util/selection/index.js.html">util/selection/index.js</a></li>
            <li><a href="../util/storage/index.js.html">util/storage/index.js</a></li>
            <li><a href="../util/storage/model.js.html">util/storage/model.js</a></li>
            <li><a href="../util/storage/msg_src.js.html">util/storage/msg_src.js</a></li>
            <li><a href="../util/unique_id.js.html">util/unique_id.js</a></li>
            <li><a href="../util/websocket/index.js.html">util/websocket/index.js</a></li>
            <li><a href="../util/websocket/msg_api.js.html">util/websocket/msg_api.js</a></li>
            <li><a href="../util/websocket/msg_src.js.html">util/websocket/msg_src.js</a></li>
          </ul>
          <div class="scrollspy">
            <ul class="nav nav-list bs-docs-sidenav affix-top">
              <li><a href="#FacetedObject"><i class="alert alert-info"></i><span>FacetedObject</span></a>
              </li>
            </ul>
          </div>
        </div>
        <div class="span9">
          <section id="FacetedObject">
            <h1>FacetedObject</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>FacetedObject()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p><code>milo.classes.FacetedObject</code><br />Component class is based on an abstract <code>FacetedObject</code> class. This class can be used in any situation where objects can be represented via collection of facets (a facet is an object of a certain class, it holds its own configuration, data and methods).<br />In a way, &quot;facets pattern&quot; is an inversion of &quot;adapter pattern&quot; - while the latter allows finding a class/methods that has specific functionality, faceted object is simply constructed to have these functionalities.<br />With this architecture it is possible to create a virtually unlimited number of component classes with a very limited number of building blocks without having any hierarchy of classes - all components inherit directly from Component class.</p><p>This constructor should be called by all subclasses constructor (it will happen automatically if a subclass is created with <code>_.createSubclass</code>).</p></div>
          <pre><code class="language-javascript">function FacetedObject() {
    // this.facetsConfig and this.facetsClasses were stored on a specific class prototype
    // when the class was created by FacetedObject.createFacetedClass
    var facetsConfig = this.facetsConfig || {};

    var facetsDescriptors = {}
        , facets = {};

    // FacetedObject class itself is not meant to be instantiated - it has no facets
    // It may change, as adding facets is possible to instances
    if (this.constructor == FacetedObject)      
        throw new Error('FacetedObject is an abstract class, can\'t be instantiated');

    // instantiate class facets
    if (this.facetsClasses)
        _.eachKey(this.facetsClasses, instantiateFacet, this, true);

    // add facets to the class as properties under their own name
    Object.defineProperties(this, facetsDescriptors);

    // store all facets on `facets` property so that they can be enumerated
    _.defineProperty(this, 'facets', facets);   

    // call `init`method if it is defined in subclass
    if (this.init)
        this.init.apply(this, arguments);

    // instantiate facet with a given class (FacetClass) and name (facetName)
    function instantiateFacet(FacetClass, facetName) {
        // get facet configuration
        var fctConfig = facetsConfig[facetName];

        // instatiate facets
        facets[facetName] = new FacetClass(this, fctConfig);

        // add facet to property descriptors
        facetsDescriptors[facetName] = {
            enumerable: true,
            value: facets[facetName]
        };
    }
}


/**
 * ####FacetedObject class methods####
 *
 * - [createFacetedClass](#FacetedObject$$createFacetedClass)
 * - [hasFacet](#FacetedObject$$hasFacet)
 */
_.extend(FacetedObject, {
    createFacetedClass: FacetedObject$$createFacetedClass,
    hasFacet: FacetedObject$$hasFacet,
    getFacetConfig: FacetedObject$$getFacetConfig
});


/**
 * ####FacetedObject instance methods####
 *
 * - [addFacet](#FacetedObject$addFacet)
 */
_.extendProto(FacetedObject, {
    addFacet: FacetedObject$addFacet
});


/**
 * FacetedObject instance method.
 * Adds a facet to the instance of FacetedObject subclass.
 * Returns an instance of the facet that was created.
 *
 * @param {Function} FacetClass facet class constructor
 * @param {Object} facetConfig optional facet configuration
 * @param {String} facetName optional facet name, FacetClass.name will be used if facetName is not passed.
 * @param {Boolean} throwOnErrors If set to false, then errors will only be logged to console. True by default.
 * @return {Facet}
 */
function FacetedObject$addFacet(FacetClass, facetConfig, facetName, throwOnErrors) {
    check(FacetClass, Function);
    check(facetName, Match.Optional(String));

    // first letter of facet name should be lowercase
    facetName = _.firstLowerCase(facetName || FacetClass.name);

    // get facets defined in class
    var protoFacets = this.constructor.prototype.facetsClasses;

    // check that this facetName was not already used in the class
    if (protoFacets &amp;&amp; protoFacets[facetName])
        throw new Error('facet ' + facetName + ' is already part of the class ' + this.constructor.name);

    // check that this faceName does not already exist on the faceted object
    if (this[facetName]) {
        var message = 'facet ' + facetName + ' is already present in object';
        if (throwOnErrors === false)
            return logger.error('FacetedObject addFacet: ', message);
        else
            throw new Error(message);
    }

    // instantiate the facet
    var newFacet = this.facets[facetName] = new FacetClass(this, facetConfig);

    // add facet to faceted object
    _.defineProperty(this, facetName, newFacet, _.ENUM);

    return newFacet;
}


/**
 * FacetedObject class method
 * Returns reference to the facet class if the facet with `facetName` is part of the class, `undefined` otherwise. If subclass is created using _.createSubclass (as it should be) it will also have this method.
 * 
 * @param {Subclass(FacetedObject)} this this in this method refers to FacetedObject (or its subclass) that calls this method
 * @param {String} facetName
 * @return {Subclass(Facet)|undefined} 
 */
function FacetedObject$$hasFacet(facetName) {
    // this refers to the FacetedObject class (or subclass), not instance
    var protoFacets = this.prototype.facetsClasses;
    return protoFacets &amp;&amp; protoFacets[facetName];
}

/**
 * FacetedObject class method
 * Return the configuration of a facet
 * @param {String} facetName the facet which config should be retrieved
 * @return {Object} the configuration object that was passed to the facet
 */
function FacetedObject$$getFacetConfig(facetName) {
    return this.hasFacet(facetName) ? this.prototype.facetsConfig[facetName] : null;
}


/**
 * FacetedObject class method
 * Class factory that creates classes (constructor functions) from the maps of facets and their configurations.
 * Created class will be subclass of `FacetedObject`.
 *
 * @param {Subclass(FacetedObject)} this this in this method refers to FacetedObject (or its subclass) that calls this method
 * @param {String} name class name (will be function name of class constructor function)
 * @param {Object[Subclass(Facet)]} facetsClasses map of classes of facets that will constitute the created class
 * @param {Object&lt;Object&gt;} facetsConfig map of facets configuration, should have the same keys as the map of classes. Some facets may not have configuration, but the configuration for a facet that is not included in facetsClasses will throw an exception
 * @return {Subclass(FacetedObject)}
 */
function FacetedObject$$createFacetedClass(name, facetsClasses, facetsConfig) {
    check(name, String);
    check(facetsClasses, Match.Optional(Match.ObjectHash(Match.Subclass(Facet, true))));
    check(facetsConfig, Match.Optional(Object));

    // throw exception if config passed for facet for which there is no class
    if (facetsConfig)
        _.eachKey(facetsConfig, function(fctConfig, fctName) {
            if (! facetsClasses.hasOwnProperty(fctName))
                throw new Error('configuration for facet (' + fctName + ') passed that is not in class');
        });

    // create subclass of the current class (this refers to the class that calls this method)
    var FacetedClass = _.createSubclass(this, name, true);

    // get facets classes and configurations from parent class
    facetsClasses = addInheritedFacets(this, facetsClasses, 'facetsClasses');
    facetsConfig = addInheritedFacets(this, facetsConfig, 'facetsConfig');

    // store facets classes and configurations of class prototype
    _.extendProto(FacetedClass, {
        facetsClasses: facetsClasses,
        facetsConfig: facetsConfig
    });

    return FacetedClass;


    function addInheritedFacets(superClass, facetsInfo, facetsInfoName) {
        var inheritedFacetsInfo = superClass.prototype[facetsInfoName];
        if (inheritedFacetsInfo)
            return _(inheritedFacetsInfo)
                    .clone()
                    .extend(facetsInfo || {})._();
        else
            return facetsInfo;
    }
}</code></pre>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p>Documentation generated with <a href="https://github.com/mr-doc/mr-doc">Mr. Doc </a> created by <a href="https://twitter.com/FGRibreau" data-show-count="false" class="twitter-follow-button">Francois-Guillaume Ribreau </a></p>
        <p>Mr. Doc is sponsored by <a href="http://bringr.net/?btt" title="Outil d'analyse des rÃ©seaux sociaux" class="bringr">Bringr </a> and <a href="https://redsmin.com/?btt" title="Full Redis GUI" class="redsmin">Redsmin</a></p>
        <p>Theme borrowed from Twitter Bootstrap</p>
      </div>
    </footer>
    <script src="../js/twitter-widget.min.js"></script>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap-transition.min.js"></script>
    <script src="../js/bootstrap-scrollspy.min.js"></script>
    <script src="../js/bootstrap-dropdown.min.js"></script>
    <script src="../js/bootstrap-collapse.min.js"></script>
    <script src="../js/bootstrap-affix.min.js"></script>
    <script src="../js/prism.min.js"></script>
    <script src="../js/index.min.js"></script>
  </body>
</html>